<%- include('../partials/html-head') %>
  <%- include('../partials/nav') %>
    <main>
      <h1>Anime Details</h1>
      <h2>
        <%= anime.title%>
      </h2>
      <img src="<%= anime.imageUrl%>" alt='<%= anime.name %> '>
      <p>
        <%= anime.synopsis %>
      </p>
      <h2>
        <%= anime.type %>
      </h2>
      <h2>
        <%= anime.episodes %>
      </h2>
      <h2>
        <%= anime.score %>
      </h2>
        <h2><%= anime.rank %> </h2>
        
        <h2><%= anime.airing %>  </h2>
        <h2>Reviews</h2>
        <% if (isSelf) { %>
          <form action="/profiles/<%= profile._id %>/anime/<%= anime._id %>/reviews" method="POST">
              <label for="content-textarea">Review:</label>
              <textarea name="content" id="content-textarea"></textarea>
              <label for="rating-select">Rating:</label>
              <select name="rating" id="rating-select">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5" selected>5</option>
              </select>
              <button type="submit">Add Review</button>
            </form>
              <% } %>
              <% if (profile.reviews.length) { %>
                <h2>
                  <%= isSelf ? "You have" : `${profile.name} has`%> reviews! Here they are!
                </h2>
                <table>
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Review</th>
                      <th>Rating</th>
                    </tr>
                  </thead>
                  <tbody>
                    <% let total=0 %>
                      <% anime.reviews.forEach(function(review){ %>

                          <tr>
                            <td>
                              <%= review.createdAt.toLocaleDateString() %>
                            </td>
                            <td>
                              <%= review.content %>
                            </td>
                            <td>
                              <%= review.rating %>
                            </td>
                          </tr>
                          <% }) %>
                            <tr>
                              <td colspan="2"></td>
                              <td>
                                <strong>
                                  <%= averageReviewScore %>
                                </strong>
                              </td>
                            </tr>
                  </tbody>
                </table>
                <% } else { %>
                  <h3>No Reviews Yet</h3>
                  <% } %>
    </main>
    <%- include('../partials/footer') %>